<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>التحقق من الشهادة</title>
  <style>
    body {
      font-family: "Courier New", monospace;
      direction: rtl;
      padding: 20px;
      background: #fafafa;
    }
    pre {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 15px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    h2 {
      color: #333;
    }
  </style>
</head>
<body>
  <h2>التحقق من الشهادة</h2>
  <div id="result">جارٍ التحقق...</div>

  <script>
    function handleCert(data) {
      const container = document.getElementById("result");

      if (data.error) {
        container.innerHTML = `<pre>❌ ${data.error}</pre>`;
        return;
      }

      // عرض البيانات بالشكل المطلوب (key : value)
      let output = "";
      for (const key in data) {
        output += `${key}\t"${data[key]}"\n`;
      }
      container.innerHTML = `<pre>${output}</pre>`;
    }

    // قراءة التوكن من الرابط
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");

    if (!token) {
      document.getElementById("result").innerHTML =
        `<pre>❌ لم يتم العثور على التوكن في الرابط</pre>`;
    } else {
      // رابط Google Script (استبدلي بالخاص بك)
      const url =
        `https://script.google.com/macros/s/AKfycbyR3kY-Fzf6Fba2GzcqQmTUoOMDpp7yGP4f3np2FrYUzMyzALzTzHo-XPbbehIVs9WUCA/exec?token=${token}&callback=handleCert`;

      let s = document.createElement("script");
      s.src = url;
      document.body.appendChild(s);
    }
  </script>
</body>
</html>
